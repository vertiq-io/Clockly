@page "/timetracker"
@using Fluxor.Blazor.Web.Components;
@using Fluxor;
@using Humanizer;
@using Vertiq.Icons;
@using Vertiq.Stores;
@inject IState<MediatorState<TimeViewModel>> State
@inherits FluxorComponent

<VDispatchOnce Dispatch="new FetchRequest(State.Value.Data)" />
<style>
    .fit-table table {
        table-layout: auto !important;
    }

    .fit-table th, .fit-table td, .fit-table thead th, .fit-table tbody td, .fit-table tfoot td, .fit-table tfoot th {
        width: auto !important;
    }
</style>

<VIf Value="State.Value.Data.TimeEntries.Count() > 0">
    <EnterTime />
</VIf>

<VTable Class="fit-table">
    <VTHead>
        <VTR>
            <VTH>Date</VTH>
            <VTH>From</VTH>
            <VTH>H</VTH>
            <VTH>To</VTH>
            <VTH>Description</VTH>
            <VTH></VTH>
        </VTR>
    </VTHead>
    <VTBody>
        <VForEach Items="@State.Value.Data.TimeEntries">
            <EmptyTemplate>
                <VTR>
                    <VTD colspan="6">
                        No times were recorded so far.

                        Do you want to <VButton Color="VColor.Primary" Href="/timetracker/record">Record Time</VButton> now?
                    </VTD>
                </VTR>
            </EmptyTemplate>
            <ChildContent>
                <VTR>
                    <VTD>@context.Date.ToShortDateString()</VTD>
                    <VTD>@context.Start</VTD>
                    <VTD>@context.End</VTD>
                    <VTD>
                        @(string.Format("{0:N2}h", context.Duration))
                    </VTD>
                    <VTD Style="width: 100%!important">@context.Description</VTD>
                    <VTD>
                        <VIconButton Icon="@MdiIcons.TrashCan"
                                     Color="VColor.Error"
                                     Dispatcher="() => new DeleteRequest(context.Id)">Delete</VIconButton>
                    </VTD>
                </VTR>
            </ChildContent>
        </VForEach>
    </VTBody>
</VTable>

